{"uid":"8e2d501a54e16e09","name":"test_executemany_bulk_insert_paramstyles[remote-qmark-INSERT INTO \"test_tbl\" VALUES (?, ?)-test_data1]","fullName":"tests.integration.dbapi.sync.V2.test_queries#test_executemany_bulk_insert_paramstyles","historyId":"ab61ea6df60f77a67613adbc87aa2d3a","time":{"start":1761039492671,"stop":1761039492992,"duration":321},"description":"executemany with bulk_insert=True works correctly for both paramstyles.","descriptionHtml":"<p>executemany with bulk_insert=True works correctly for both paramstyles.</p>\n","status":"broken","statusMessage":"firebolt.utils.exception.FireboltStructuredError: - Failed to commit transaction, error: 'detected 1 conflicts with 1 transactions on transaction commit', code: 9, transaction id: 0000594a64d3e0170000, account_id: 01hzdxdxjqa9n6c07d5j51skep","statusTrace":"connection = <firebolt.db.connection.Connection object at 0x7f38f17d6a50>\nparamstyle = 'qmark', query = 'INSERT INTO \"test_tbl\" VALUES (?, ?)'\ntest_data = [(4, 'david'), (5, 'eve'), (6, 'frank')]\ncreate_drop_test_table_setup_teardown = <firebolt.db.cursor.CursorV2 object at 0x7f38f17fbaf0>\n\n    @mark.parametrize(\n        \"paramstyle,query,test_data\",\n        [\n            (\n                \"fb_numeric\",\n                'INSERT INTO \"test_tbl\" VALUES ($1, $2)',\n                [(1, \"alice\"), (2, \"bob\"), (3, \"charlie\")],\n            ),\n            (\n                \"qmark\",\n                'INSERT INTO \"test_tbl\" VALUES (?, ?)',\n                [(4, \"david\"), (5, \"eve\"), (6, \"frank\")],\n            ),\n        ],\n    )\n    def test_executemany_bulk_insert_paramstyles(\n        connection: Connection,\n        paramstyle: str,\n        query: str,\n        test_data: List[Tuple],\n        create_drop_test_table_setup_teardown: Callable,\n    ) -> None:\n        \"\"\"executemany with bulk_insert=True works correctly for both paramstyles.\"\"\"\n        # Set the paramstyle for this test\n        original_paramstyle = firebolt.db.paramstyle\n        firebolt.db.paramstyle = paramstyle\n        # Generate a unique label for this test execution\n        unique_label = f\"test_bulk_insert_{paramstyle}_{randint(100000, 999999)}\"\n        table_name = \"test_tbl\"\n    \n        try:\n            c = connection.cursor()\n    \n            # Can't do this for fb_numeric yet - FIR-49970\n            if paramstyle != \"fb_numeric\":\n                c.execute(f\"SET query_label = '{unique_label}'\")\n    \n            # Execute bulk insert\n>           c.executemany(\n                query,\n                test_data,\n                bulk_insert=True,\n            )\n\ntests/integration/dbapi/sync/V2/test_queries.py:326: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/common/cursor/decorators.py:24: in inner\n    return func(self, *args, **kwargs)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:432: in executemany\n    self._do_execute(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:248: in _do_execute\n    self._execute_plan(plan, timeout)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:272: in _execute_plan\n    self._execute_single_query(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:300: in _execute_single_query\n    self._raise_if_error(resp)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:125: in _raise_if_error\n    raise_error_from_response(resp)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nresp = <Response [409 Conflict]>\n\n    def raise_error_from_response(resp: Response) -> None:\n        \"\"\"\n        Raise a correct error from the response.\n        Look for a structured error in the body and raise it.\n        If the body doesn't contain a structured error,\n        log the body and raise a status code error.\n    \n        Args:\n            resp (Response): HTTP response\n        \"\"\"\n        to_raise = None\n        try:\n            decoded = resp.json()\n            if \"errors\" in decoded and len(decoded[\"errors\"]) > 0:\n                # Raise later to avoid catching it in the except block\n                to_raise = FireboltStructuredError(decoded)\n    \n        except Exception:\n            # If we can't parse the body, print out the error body\n            if \"Content-Length\" in resp.headers and int(resp.headers[\"Content-Length\"]) > 0:\n                logger.error(f\"Something went wrong: {resp.read().decode('utf-8')}\")\n    \n        if to_raise:\n>           raise to_raise\nE           firebolt.utils.exception.FireboltStructuredError: - Failed to commit transaction, error: 'detected 1 conflicts with 1 transactions on transaction commit', code: 9, transaction id: 0000594a64d3e0170000, account_id: 01hzdxdxjqa9n6c07d5j51skep\n\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/utils/util.py:186: FireboltStructuredError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1761039479575,"stop":1761039479575,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_add_to_builtins","time":{"start":1761039479575,"stop":1761039479575,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"database_name","time":{"start":1761039479576,"stop":1761039479576,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_id","time":{"start":1761039479576,"stop":1761039479577,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session","time":{"start":1761039479576,"stop":1761039479576,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1761039479576,"stop":1761039479576,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1761039479577,"stop":1761039479832,"duration":255},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_secret","time":{"start":1761039479577,"stop":1761039479577,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1761039479835,"stop":1761039479835,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_name","time":{"start":1761039480355,"stop":1761039480355,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_auth","time":{"start":1761039480355,"stop":1761039480356,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_url","time":{"start":1761039480356,"stop":1761039480356,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection","time":{"start":1761039492474,"stop":1761039492528,"duration":54},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_maybe_fail","time":{"start":1761039492474,"stop":1761039492474,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_drop_test_table_setup_teardown","time":{"start":1761039492529,"stop":1761039492670,"duration":141},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"create_drop_test_table_setup_teardown::0","time":{"start":1761039493042,"stop":1761039493101,"duration":59},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection::0","time":{"start":1761039493102,"stop":1761039493103,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_maybe_fail::0","time":{"start":1761039493103,"stop":1761039493103,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session::0","time":{"start":1761039598327,"stop":1761039598327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.integration.dbapi.sync.V2"},{"name":"suite","value":"test_queries"},{"name":"host","value":"runnervmwhb2z"},{"name":"thread","value":"2493-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.dbapi.sync.V2.test_queries"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"connection","value":"'remote'"},{"name":"paramstyle","value":"'qmark'"},{"name":"query","value":"'INSERT INTO \"test_tbl\" VALUES (?, ?)'"},{"name":"test_data","value":"[(4, 'david'), (5, 'eve'), (6, 'frank')]"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"8e2d501a54e16e09.json","parameterValues":["'remote'","'qmark'","'INSERT INTO \"test_tbl\" VALUES (?, ?)'","[(4, 'david'), (5, 'eve'), (6, 'frank')]"]}
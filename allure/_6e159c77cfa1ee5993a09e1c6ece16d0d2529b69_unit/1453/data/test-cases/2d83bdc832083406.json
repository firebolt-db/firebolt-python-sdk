{"uid":"2d83bdc832083406","name":"test_rm_token_cache","fullName":"tests.unit.service.test_resource_manager#test_rm_token_cache","historyId":"11a09670b132a9881f51a3f0fd652f8c","time":{"start":1755863779198,"stop":1755863779390,"duration":192},"description":"Credentials, that are passed to rm are cached properly.","descriptionHtml":"<p>Credentials, that are passed to rm are cached properly.</p>\n","status":"failed","statusMessage":"AssertionError: Invalid token value cached\nassert None == 'mock_access_token'\n +  where None = <bound method TokenSecureStorage.get_cached_token of <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>>()\n +    where <bound method TokenSecureStorage.get_cached_token of <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>> = <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>.get_cached_token","statusTrace":"httpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7fd205d7bb50>\ncheck_token_callback = <function check_token_callback.<locals>.check_token at 0x7fd205f28820>\nauth = <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7fd2082bc9c0>\napi_endpoint = 'api-dev.mock.firebolt.io', account_name = 'mock_account_name'\naccess_token = 'mock_access_token'\nmock_system_engine_connection_flow = <function mock_system_engine_connection_flow.<locals>.inner at 0x7fd205c9ab80>\n\n    @mark.nofakefs\n    def test_rm_token_cache(\n        httpx_mock: HTTPXMock,\n        check_token_callback: Callable,\n        auth: Auth,\n        api_endpoint: str,\n        account_name: str,\n        access_token: str,\n        mock_system_engine_connection_flow: Callable,\n    ) -> None:\n        \"\"\"Credentials, that are passed to rm are cached properly.\"\"\"\n        url = \"https://url\"\n    \n        mock_system_engine_connection_flow()\n        httpx_mock.add_callback(check_token_callback, url=url)\n    \n        with Patcher():\n            rm = ResourceManager(\n                auth=ClientCredentials(\n                    auth.client_id, auth.client_secret, use_token_cache=True\n                ),\n                account_name=account_name,\n                api_endpoint=api_endpoint,\n            )\n            rm._client.get(url)\n    \n            ts = TokenSecureStorage(auth.client_id, auth.client_secret)\n>           assert ts.get_cached_token() == access_token, \"Invalid token value cached\"\nE           AssertionError: Invalid token value cached\nE           assert None == 'mock_access_token'\nE            +  where None = <bound method TokenSecureStorage.get_cached_token of <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>>()\nE            +    where <bound method TokenSecureStorage.get_cached_token of <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>> = <firebolt.utils.token_storage.TokenSecureStorage object at 0x7fd205b8e4f0>.get_cached_token\n\ntests/unit/service/test_resource_manager.py:59: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"clear_cache","time":{"start":1755863779190,"stop":1755863779190,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1755863779190,"stop":1755863779190,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs","time":{"start":1755863779190,"stop":1755863779190,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"assert_all_responses_were_requested","time":{"start":1755863779190,"stop":1755863779190,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"disable_cache","time":{"start":1755863779190,"stop":1755863779190,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"client_secret","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"access_token","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"httpx_mock","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"check_token_callback","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1755863779191,"stop":1755863779195,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"non_mocked_hosts","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"client_id","time":{"start":1755863779191,"stop":1755863779191,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1755863779195,"stop":1755863779196,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1755863779196,"stop":1755863779196,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_system_engine_url","time":{"start":1755863779196,"stop":1755863779197,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_url","time":{"start":1755863779196,"stop":1755863779196,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_endpoint","time":{"start":1755863779196,"stop":1755863779196,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"check_credentials_callback","time":{"start":1755863779196,"stop":1755863779196,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_system_engine_callback","time":{"start":1755863779197,"stop":1755863779197,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_system_engine_connection_flow","time":{"start":1755863779197,"stop":1755863779197,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"system_engine_url","time":{"start":1755863779197,"stop":1755863779197,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"httpx_mock::0","time":{"start":1755863779399,"stop":1755863779400,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1755863779401,"stop":1755863779401,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs::0","time":{"start":1755863779401,"stop":1755863779401,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"nofakefs"},{"name":"parentSuite","value":"tests.unit.service"},{"name":"suite","value":"test_resource_manager"},{"name":"host","value":"pkrvmqc4gcfdwos"},{"name":"thread","value":"2445-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.service.test_resource_manager"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":["nofakefs"]},"source":"2d83bdc832083406.json","parameterValues":[]}
{"uid":"6591e7b9b49adf3a","name":"test_begin_with_autocommit_on[remote]","fullName":"tests.integration.dbapi.sync.V2.test_queries#test_begin_with_autocommit_on","historyId":"0902163a86f0ab7052935d8bdd01055e","time":{"start":1761758779141,"stop":1761758780479,"duration":1338},"description":"Test that BEGIN does not start a transaction when autocommit is enabled.","descriptionHtml":"<p>Test that BEGIN does not start a transaction when autocommit is enabled.</p>\n","status":"failed","statusMessage":"Failed: DID NOT RAISE <class 'Exception'>","statusTrace":"create_drop_test_table_setup_teardown = 'test_table_d3a2f737db3e45fd9334c05ac48715a4'\nconnection_factory = <function connection_factory.<locals>.factory at 0x7f4661961670>\n\n    @mark.parametrize(\"connection_factory\", [\"remote\"], indirect=True)\n    def test_begin_with_autocommit_on(\n        create_drop_test_table_setup_teardown: Callable,\n        connection_factory: Callable[..., Connection],\n    ) -> None:\n        \"\"\"Test that BEGIN does not start a transaction when autocommit is enabled.\"\"\"\n        table_name = create_drop_test_table_setup_teardown\n    \n        with connection_factory(autocommit=False) as connection_autocommit_off:\n            cursor = connection_autocommit_off.cursor()\n            # Test that data is immediately visible without explicit transaction (autocommit)\n            cursor.execute(f\"INSERT INTO \\\"{table_name}\\\" VALUES (1, 'autocommit_test')\")\n    \n            # Create a second cursor to verify data is visible immediately\n            cursor2 = connection_autocommit_off.cursor()\n            cursor2.execute(f'SELECT * FROM \"{table_name}\" WHERE id = 1')\n            data = cursor2.fetchall()\n            assert len(data) == 1, \"Data should be visible immediately with autocommit\"\n            assert data[0] == [1, \"autocommit_test\"], \"Data should match inserted values\"\n    \n            # Now test with explicit BEGIN - this should be a no-op when autocommit is enabled\n            # Can't run this in autocommit off\n            # result = cursor.execute(\"BEGIN TRANSACTION\")\n            # assert result == 0, \"BEGIN TRANSACTION should return 0 rows\"\n            # assert (\n            #     not connection_autocommit_off.in_transaction\n            # ), \"Transaction should not be started when autocommit is enabled\"\n    \n            cursor.execute(\n                f\"INSERT INTO \\\"{table_name}\\\" VALUES (2, 'no_transaction_test')\"\n            )\n    \n            # ROLLBACK should fail since no transaction was started\n            with raises(Exception):\n>               cursor.execute(\"ROLLBACK\")\nE               Failed: DID NOT RAISE <class 'Exception'>\n\ntests/integration/dbapi/sync/V2/test_queries.py:966: Failed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"insert_assert_add_to_builtins","time":{"start":1761758724676,"stop":1761758724676,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_name","time":{"start":1761758724677,"stop":1761758724677,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1761758724677,"stop":1761758724677,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session","time":{"start":1761758724677,"stop":1761758724677,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_id","time":{"start":1761758724681,"stop":1761758724681,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"database_name","time":{"start":1761758724681,"stop":1761758724681,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_secret","time":{"start":1761758724682,"stop":1761758724682,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1761758724682,"stop":1761758724861,"duration":179},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_auth","time":{"start":1761758724864,"stop":1761758724864,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_url","time":{"start":1761758724865,"stop":1761758724865,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1761758724865,"stop":1761758724865,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1761758724865,"stop":1761758724865,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_maybe_fail","time":{"start":1761758778822,"stop":1761758778822,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection_factory","time":{"start":1761758778823,"stop":1761758778823,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection","time":{"start":1761758778823,"stop":1761758778882,"duration":59},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_drop_test_table_setup_teardown","time":{"start":1761758778882,"stop":1761758779140,"duration":258},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"create_drop_test_table_setup_teardown::0","time":{"start":1761758780528,"stop":1761758780665,"duration":137},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection::0","time":{"start":1761758780665,"stop":1761758780666,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_maybe_fail::0","time":{"start":1761758780666,"stop":1761758780666,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session::0","time":{"start":1761758869276,"stop":1761758869276,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.integration.dbapi.sync.V2"},{"name":"suite","value":"test_queries"},{"name":"host","value":"runnervmwhb2z"},{"name":"thread","value":"2528-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.dbapi.sync.V2.test_queries"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"connection_factory","value":"'remote'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"6591e7b9b49adf3a.json","parameterValues":["'remote'"]}
{"uid":"9b5e2d0eddec1b31","name":"test_database_switching_with_same_engine_preserves_database_context[remote]","fullName":"tests.integration.dbapi.sync.V2.test_queries#test_database_switching_with_same_engine_preserves_database_context","historyId":"3194ec399026959a0343a84dc54de677","time":{"start":1764012604856,"stop":1764012605467,"duration":611},"description":"\n    Integration test for database context preservation with caching on Firebolt.\n\n    This test verifies against a live Firebolt instance:\n    1. Connect with database1 + engine1 (cache entry created)\n    2. Connect with database2 + engine1 (should add database2 to cache)\n    3. Cursors from second connection should have database2, not database1\n    ","descriptionHtml":"<pre><code>Integration test for database context preservation with caching on Firebolt.\n\nThis test verifies against a live Firebolt instance:\n1. Connect with database1 + engine1 (cache entry created)\n2. Connect with database2 + engine1 (should add database2 to cache)\n3. Cursors from second connection should have database2, not database1\n</code></pre>\n","status":"broken","statusMessage":"TypeError: firebolt.db.connection.connect() got multiple values for keyword argument 'database'","statusTrace":"database_name = 'integration_testing__1764012420112'\nconnection_factory = <function connection_factory.<locals>.factory at 0x7fbe41ca6700>\n\n    def test_database_switching_with_same_engine_preserves_database_context(\n        database_name: str,\n        connection_factory: Callable[..., Connection],\n    ) -> None:\n        \"\"\"\n        Integration test for database context preservation with caching on Firebolt.\n    \n        This test verifies against a live Firebolt instance:\n        1. Connect with database1 + engine1 (cache entry created)\n        2. Connect with database2 + engine1 (should add database2 to cache)\n        3. Cursors from second connection should have database2, not database1\n        \"\"\"\n        first_db_name = database_name\n        second_db_name = f\"{database_name}_second\"\n    \n        # Create a system connection to set up test databases\n        with connection_factory() as system_connection:\n            system_cursor = system_connection.cursor()\n    \n            try:\n                # Create the second test database\n                system_cursor.execute(f'CREATE DATABASE IF NOT EXISTS \"{second_db_name}\"')\n    \n                # First connection: database1 + engine1\n>               with connection_factory(database=first_db_name) as connection1:\n\ntests/integration/dbapi/sync/V2/test_queries.py:1205: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkwargs = {'database': 'integration_testing__1764012420112'}\nbase_kwargs = {'account_name': 'automation', 'api_endpoint': 'api.staging.firebolt.io', 'auth': <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7fbe424736c0>, 'database': 'integration_testing__1764012420112', ...}\n\n    def factory(**kwargs: Any) -> Connection:\n        if request.param == \"core\":\n            base_kwargs = {\n                \"database\": kwargs.pop(\"database\", \"firebolt\"),\n                \"auth\": core_auth,\n                \"url\": core_url,\n            }\n        else:\n            base_kwargs = {\n                \"engine_name\": engine_name,\n                \"database\": database_name,\n                \"auth\": auth,\n                \"account_name\": account_name,\n                \"api_endpoint\": api_endpoint,\n            }\n>       return connect(**base_kwargs, **kwargs)\nE       TypeError: firebolt.db.connection.connect() got multiple values for keyword argument 'database'\n\ntests/integration/dbapi/sync/V2/conftest.py:56: TypeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"database_name","time":{"start":1764012544848,"stop":1764012544848,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_add_to_builtins","time":{"start":1764012544848,"stop":1764012544848,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session","time":{"start":1764012544848,"stop":1764012544848,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1764012544848,"stop":1764012544848,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_secret","time":{"start":1764012544849,"stop":1764012544849,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_id","time":{"start":1764012544849,"stop":1764012544849,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1764012544849,"stop":1764012544849,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1764012544850,"stop":1764012545002,"duration":152},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1764012545002,"stop":1764012545002,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_name","time":{"start":1764012545722,"stop":1764012545722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_url","time":{"start":1764012545722,"stop":1764012545722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_auth","time":{"start":1764012545722,"stop":1764012545722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection_factory","time":{"start":1764012604855,"stop":1764012604855,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_maybe_fail","time":{"start":1764012604855,"stop":1764012604855,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"insert_assert_maybe_fail::0","time":{"start":1764012605490,"stop":1764012605490,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"insert_assert_session::0","time":{"start":1764012833898,"stop":1764012833898,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.integration.dbapi.sync.V2"},{"name":"suite","value":"test_queries"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2584-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.dbapi.sync.V2.test_queries"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"connection_factory","value":"'remote'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"9b5e2d0eddec1b31.json","parameterValues":["'remote'"]}
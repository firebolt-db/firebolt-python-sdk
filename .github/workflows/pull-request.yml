name: Pull request code checks

on:
  pull_request:
    branches: [ main, 0.x ]

jobs:
  print-association:
    runs-on: ubuntu-latest
    steps:
      - name: Check if internal user
        id: check
        uses: scherermichael-oss/action-has-permission@master
        with:
            required-permission: write
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Print association
        if: steps.check.outputs.has-permission
        run: |
          echo "Author association: ${{ github.event.pull_request.author_association }}"
  code-checkers:
    if: github.event.pull_request.author_association == 'MEMBER' || github.event.pull_request.author_association == 'OWNER'
    uses: ./.github/workflows/code-check.yml
  unit-tests:
    uses: ./.github/workflows/unit-tests.yml
    secrets:
      GIST_PAT: ${{ secrets.GIST_PAT }}
      
  security-scan:
    needs: [unit-tests]
    uses: ./.github/workflows/security-scan.yml
    secrets:
      FOSSA_TOKEN: ${{ secrets.FOSSA_TOKEN }}
      SONARCLOUD_TOKEN: ${{ secrets.SONARCLOUD_TOKEN }}


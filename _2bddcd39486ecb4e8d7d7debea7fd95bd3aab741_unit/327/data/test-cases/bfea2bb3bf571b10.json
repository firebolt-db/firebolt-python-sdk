{"uid":"bfea2bb3bf571b10","name":"test_connect_caching[True]","fullName":"tests.unit.db.test_connection#test_connect_caching","historyId":"d696a77f76f4bb8d897419f7b893e9d1","time":{"start":1728875475044,"stop":1728875475408,"duration":364},"status":"failed","statusMessage":"AssertionError: System engine URL was not cached\nassert 3 == 1","statusTrace":"db_name = 'database', engine_name = 'mock_engine_name'\nauth_url = 'https://id.mock.firebolt.io/oauth/token'\napi_endpoint = 'api-dev.mock.firebolt.io'\nauth = <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7f03c0ac8340>\naccount_name = 'mock_account_name'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7f03c06346d0>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7f03c0b1fdc0>\nget_system_engine_url = URL('https://api-dev.mock.firebolt.io/web/v3/account/mock_account_name/engineUrl')\nget_system_engine_callback = <function get_system_engine_callback.<locals>.inner at 0x7f03c0b1ff70>\nsystem_engine_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact&database=database'\nsystem_engine_no_db_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact'\nquery_url = URL('https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database')\nuse_database_callback = <function use_database_callback.<locals>.inner at 0x7f03c0b20160>\nuse_engine_callback = <function use_engine_callback.<locals>.inner at 0x7f03c0b204c0>\nquery_callback = <function query_callback.<locals>.do_query at 0x7f03c0b20430>\ncache_enabled = True\n\n    @mark.parametrize(\"cache_enabled\", [True, False])\n    def test_connect_caching(\n        db_name: str,\n        engine_name: str,\n        auth_url: str,\n        api_endpoint: str,\n        auth: Auth,\n        account_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        get_system_engine_url: str,\n        get_system_engine_callback: Callable,\n        system_engine_query_url: str,\n        system_engine_no_db_query_url: str,\n        query_url: str,\n        use_database_callback: Callable,\n        use_engine_callback: Callable,\n        query_callback: Callable,\n        cache_enabled: bool,\n    ):\n        system_engine_call_counter = 0\n    \n        def system_engine_callback_counter(request, **kwargs):\n            nonlocal system_engine_call_counter\n            system_engine_call_counter += 1\n            return get_system_engine_callback(request, **kwargs)\n    \n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(system_engine_callback_counter, url=get_system_engine_url)\n        httpx_mock.add_callback(\n            use_database_callback,\n            url=system_engine_no_db_query_url,\n            match_content=f'USE DATABASE \"{db_name}\"'.encode(\"utf-8\"),\n        )\n    \n        httpx_mock.add_callback(\n            use_engine_callback,\n            url=system_engine_query_url,\n            match_content=f'USE ENGINE \"{engine_name}\"'.encode(\"utf-8\"),\n        )\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        for _ in range(3):\n            with connect(\n                database=db_name,\n                engine_name=engine_name,\n                auth=auth,\n                account_name=account_name,\n                api_endpoint=api_endpoint,\n                disable_cache=not cache_enabled,\n            ) as connection:\n                connection.cursor().execute(\"select*\")\n    \n        if cache_enabled:\n>           assert system_engine_call_counter == 1, \"System engine URL was not cached\"\nE           AssertionError: System engine URL was not cached\nE           assert 3 == 1\n\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/db/test_connection.py:246: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"clear_cache","time":{"start":1728875474952,"stop":1728875474952,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs","time":{"start":1728875474953,"stop":1728875474958,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"global_fake_fs::0","time":{"start":1728875475451,"stop":1728875475452,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.unit.db"},{"name":"suite","value":"test_connection"},{"name":"host","value":"fv-az1296-862"},{"name":"thread","value":"2365-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.db.test_connection"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"cache_enabled","value":"True"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":47,"broken":0,"skipped":0,"passed":22,"unknown":0,"total":69},"items":[{"uid":"cf7968b01b5e010e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/323//#testresult/cf7968b01b5e010e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728789193472,"stop":1728789193841,"duration":369}},{"uid":"ddd804bcc0b6603c","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/326//#testresult/ddd804bcc0b6603c","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728789062605,"stop":1728789062968,"duration":363}},{"uid":"fa3637135ec22e80","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/322//#testresult/fa3637135ec22e80","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728702511810,"stop":1728702512215,"duration":405}},{"uid":"f9f79a407ba1b08a","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/325//#testresult/f9f79a407ba1b08a","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728702394360,"stop":1728702394787,"duration":427}},{"uid":"f8a6baf6d90c26c6","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/321//#testresult/f8a6baf6d90c26c6","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728616199319,"stop":1728616199739,"duration":420}},{"uid":"f9b1466f358891f8","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/324//#testresult/f9b1466f358891f8","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728616061543,"stop":1728616061954,"duration":411}},{"uid":"a90f85bcab78a514","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/320//#testresult/a90f85bcab78a514","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728530080434,"stop":1728530080851,"duration":417}},{"uid":"8c861d78031b3dda","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/323//#testresult/8c861d78031b3dda","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728529713943,"stop":1728529714375,"duration":432}},{"uid":"46b21d289b748523","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/319//#testresult/46b21d289b748523","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728443443697,"stop":1728443444120,"duration":423}},{"uid":"586afe2142ac4f40","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/322//#testresult/586afe2142ac4f40","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728443311728,"stop":1728443312156,"duration":428}},{"uid":"d53d8de28bedc243","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/318//#testresult/d53d8de28bedc243","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728357113539,"stop":1728357113846,"duration":307}},{"uid":"4bbdd438d64764b1","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/321//#testresult/4bbdd438d64764b1","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728356980273,"stop":1728356980581,"duration":308}},{"uid":"b7a2729b6e0860ed","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/317//#testresult/b7a2729b6e0860ed","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728270719339,"stop":1728270719652,"duration":313}},{"uid":"22b047435387d437","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/320//#testresult/22b047435387d437","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728270618303,"stop":1728270618604,"duration":301}},{"uid":"8b46ef62c6df588e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/316//#testresult/8b46ef62c6df588e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728184347433,"stop":1728184347734,"duration":301}},{"uid":"c176cae828453eee","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/319//#testresult/c176cae828453eee","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728184213052,"stop":1728184213357,"duration":305}},{"uid":"3431ae3be238b1d5","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/315//#testresult/3431ae3be238b1d5","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728097726083,"stop":1728097726387,"duration":304}},{"uid":"2183c4e5e89ecf38","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/318//#testresult/2183c4e5e89ecf38","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728097588329,"stop":1728097588637,"duration":308}},{"uid":"63e86699c4695608","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/314//#testresult/63e86699c4695608","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728011395579,"stop":1728011395883,"duration":304}},{"uid":"b192ad99ba37a95e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/317//#testresult/b192ad99ba37a95e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728011254847,"stop":1728011255180,"duration":333}}]},"tags":[]},"source":"bfea2bb3bf571b10.json","parameterValues":["True"]}
{"uid":"2183c4e5e89ecf38","name":"test_connect_caching[True]","fullName":"tests.unit.db.test_connection#test_connect_caching","historyId":"d696a77f76f4bb8d897419f7b893e9d1","time":{"start":1728097588329,"stop":1728097588637,"duration":308},"status":"failed","statusMessage":"AssertionError: System engine URL was not cached\nassert 3 == 1","statusTrace":"db_name = 'database', engine_name = 'mock_engine_name'\nauth_url = 'https://id.mock.firebolt.io/oauth/token'\napi_endpoint = 'api-dev.mock.firebolt.io'\nauth = <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7f7234b778c0>\naccount_name = 'mock_account_name'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7f72347fa4c0>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7f72347def70>\nget_system_engine_url = URL('https://api-dev.mock.firebolt.io/web/v3/account/mock_account_name/engineUrl')\nget_system_engine_callback = <function get_system_engine_callback.<locals>.inner at 0x7f72347de280>\nsystem_engine_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact&database=database'\nsystem_engine_no_db_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact'\nquery_url = URL('https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database')\nuse_database_callback = <function use_database_callback.<locals>.inner at 0x7f7234ac8a60>\nuse_engine_callback = <function use_engine_callback.<locals>.inner at 0x7f7234ac8e50>\nquery_callback = <function query_callback.<locals>.do_query at 0x7f7234b3f4c0>\ncache_enabled = True\n\n    @mark.parametrize(\"cache_enabled\", [True, False])\n    def test_connect_caching(\n        db_name: str,\n        engine_name: str,\n        auth_url: str,\n        api_endpoint: str,\n        auth: Auth,\n        account_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        get_system_engine_url: str,\n        get_system_engine_callback: Callable,\n        system_engine_query_url: str,\n        system_engine_no_db_query_url: str,\n        query_url: str,\n        use_database_callback: Callable,\n        use_engine_callback: Callable,\n        query_callback: Callable,\n        cache_enabled: bool,\n    ):\n        system_engine_call_counter = 0\n    \n        def system_engine_callback_counter(request, **kwargs):\n            nonlocal system_engine_call_counter\n            system_engine_call_counter += 1\n            return get_system_engine_callback(request, **kwargs)\n    \n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(system_engine_callback_counter, url=get_system_engine_url)\n        httpx_mock.add_callback(\n            use_database_callback,\n            url=system_engine_no_db_query_url,\n            match_content=f'USE DATABASE \"{db_name}\"'.encode(\"utf-8\"),\n        )\n    \n        httpx_mock.add_callback(\n            use_engine_callback,\n            url=system_engine_query_url,\n            match_content=f'USE ENGINE \"{engine_name}\"'.encode(\"utf-8\"),\n        )\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        for _ in range(3):\n            with connect(\n                database=db_name,\n                engine_name=engine_name,\n                auth=auth,\n                account_name=account_name,\n                api_endpoint=api_endpoint,\n                disable_cache=not cache_enabled,\n            ) as connection:\n                connection.cursor().execute(\"select*\")\n    \n        if cache_enabled:\n>           assert system_engine_call_counter == 1, \"System engine URL was not cached\"\nE           AssertionError: System engine URL was not cached\nE           assert 3 == 1\n\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/db/test_connection.py:246: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"clear_cache","time":{"start":1728097588294,"stop":1728097588294,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs","time":{"start":1728097588294,"stop":1728097588296,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_endpoint","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"client_id","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_name","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_url","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_name","time":{"start":1728097588297,"stop":1728097588297,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1728097588298,"stop":1728097588324,"duration":26},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"client_secret","time":{"start":1728097588298,"stop":1728097588298,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1728097588324,"stop":1728097588324,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1728097588324,"stop":1728097588324,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"httpx_mock","time":{"start":1728097588325,"stop":1728097588325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_system_engine_url","time":{"start":1728097588325,"stop":1728097588326,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"non_mocked_hosts","time":{"start":1728097588325,"stop":1728097588325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"assert_all_responses_were_requested","time":{"start":1728097588325,"stop":1728097588325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"check_credentials_callback","time":{"start":1728097588325,"stop":1728097588325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"access_token","time":{"start":1728097588325,"stop":1728097588325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_url","time":{"start":1728097588326,"stop":1728097588326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_system_engine_callback","time":{"start":1728097588326,"stop":1728097588326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"system_engine_no_db_query_url","time":{"start":1728097588326,"stop":1728097588326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"system_engine_url","time":{"start":1728097588326,"stop":1728097588326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"system_engine_query_url","time":{"start":1728097588326,"stop":1728097588326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_statistics","time":{"start":1728097588327,"stop":1728097588327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"use_database_callback","time":{"start":1728097588327,"stop":1728097588327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_description","time":{"start":1728097588327,"stop":1728097588327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_data","time":{"start":1728097588327,"stop":1728097588328,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"use_engine_callback","time":{"start":1728097588327,"stop":1728097588327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_url","time":{"start":1728097588327,"stop":1728097588327,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_callback","time":{"start":1728097588328,"stop":1728097588328,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"httpx_mock::0","time":{"start":1728097588654,"stop":1728097588654,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1728097588655,"stop":1728097588655,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs::0","time":{"start":1728097588659,"stop":1728097588659,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.unit.db"},{"name":"suite","value":"test_connection"},{"name":"host","value":"fv-az1024-661"},{"name":"thread","value":"2098-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.db.test_connection"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"cache_enabled","value":"True"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":29,"broken":0,"skipped":0,"passed":22,"unknown":0,"total":51},"items":[{"uid":"63e86699c4695608","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/314//#testresult/63e86699c4695608","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728011395579,"stop":1728011395883,"duration":304}},{"uid":"b192ad99ba37a95e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/317//#testresult/b192ad99ba37a95e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1728011254847,"stop":1728011255180,"duration":333}},{"uid":"bd7cc70f98cb4d59","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/313//#testresult/bd7cc70f98cb4d59","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727924990079,"stop":1727924990397,"duration":318}},{"uid":"fdebbf97d3c824d9","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/316//#testresult/fdebbf97d3c824d9","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727924860686,"stop":1727924860994,"duration":308}},{"uid":"aff248d031f1ad8a","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/312//#testresult/aff248d031f1ad8a","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727838551936,"stop":1727838552234,"duration":298}},{"uid":"f2ca1f3babb55f13","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/315//#testresult/f2ca1f3babb55f13","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727838416614,"stop":1727838416934,"duration":320}},{"uid":"dcc751966f86816c","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/311//#testresult/dcc751966f86816c","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727752592933,"stop":1727752593243,"duration":310}},{"uid":"1e9a2709ac9eb21c","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/314//#testresult/1e9a2709ac9eb21c","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727752434827,"stop":1727752435139,"duration":312}},{"uid":"d47af95d76353847","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/310//#testresult/d47af95d76353847","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727666031232,"stop":1727666031532,"duration":300}},{"uid":"7bcbb89685df2408","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/313//#testresult/7bcbb89685df2408","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727665894696,"stop":1727665895004,"duration":308}},{"uid":"69ef566cf0bfdbcc","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/309//#testresult/69ef566cf0bfdbcc","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727579581348,"stop":1727579581652,"duration":304}},{"uid":"477e7048f873916e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/312//#testresult/477e7048f873916e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727579459118,"stop":1727579459441,"duration":323}},{"uid":"27571d44dc378a9e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/308//#testresult/27571d44dc378a9e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727492936371,"stop":1727492936697,"duration":326}},{"uid":"a0e46a9506a5fce2","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/311//#testresult/a0e46a9506a5fce2","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727492806130,"stop":1727492806445,"duration":315}},{"uid":"60734194dbda16a","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/306//#testresult/60734194dbda16a","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727320200627,"stop":1727320200944,"duration":317}},{"uid":"324b97cb39d98696","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/309//#testresult/324b97cb39d98696","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727320075714,"stop":1727320076017,"duration":303}},{"uid":"b49324fa5b1d1a16","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/305//#testresult/b49324fa5b1d1a16","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727233880884,"stop":1727233881173,"duration":289}},{"uid":"379c7d72c6c032bc","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/308//#testresult/379c7d72c6c032bc","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727233759031,"stop":1727233759339,"duration":308}},{"uid":"a2139c2abbdedaa5","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/304//#testresult/a2139c2abbdedaa5","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727147383984,"stop":1727147384299,"duration":315}},{"uid":"622a1e1707fec03b","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/307//#testresult/622a1e1707fec03b","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1727147236213,"stop":1727147236514,"duration":301}}]},"tags":[]},"source":"2183c4e5e89ecf38.json","parameterValues":["True"]}
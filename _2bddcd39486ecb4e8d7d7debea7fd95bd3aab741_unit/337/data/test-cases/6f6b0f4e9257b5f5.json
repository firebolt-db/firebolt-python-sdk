{"uid":"6f6b0f4e9257b5f5","name":"test_connect_caching[True]","fullName":"tests.unit.db.test_connection#test_connect_caching","historyId":"d696a77f76f4bb8d897419f7b893e9d1","time":{"start":1729998839317,"stop":1729998839732,"duration":415},"status":"failed","statusMessage":"AssertionError: System engine URL was not cached\nassert 3 == 1","statusTrace":"db_name = 'database', engine_name = 'mock_engine_name'\nauth_url = 'https://id.mock.firebolt.io/oauth/token'\napi_endpoint = 'api-dev.mock.firebolt.io'\nauth = <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7f3058e72dc0>\naccount_name = 'mock_account_name'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7f30592b55e0>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7f305c601430>\nget_system_engine_url = URL('https://api-dev.mock.firebolt.io/web/v3/account/mock_account_name/engineUrl')\nget_system_engine_callback = <function get_system_engine_callback.<locals>.inner at 0x7f305c601550>\nsystem_engine_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact&database=database'\nsystem_engine_no_db_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact'\nquery_url = URL('https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database')\nuse_database_callback = <function use_database_callback.<locals>.inner at 0x7f30592600d0>\nuse_engine_callback = <function use_engine_callback.<locals>.inner at 0x7f3059260310>\nquery_callback = <function query_callback.<locals>.do_query at 0x7f3059260a60>\ncache_enabled = True\n\n    @mark.parametrize(\"cache_enabled\", [True, False])\n    def test_connect_caching(\n        db_name: str,\n        engine_name: str,\n        auth_url: str,\n        api_endpoint: str,\n        auth: Auth,\n        account_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        get_system_engine_url: str,\n        get_system_engine_callback: Callable,\n        system_engine_query_url: str,\n        system_engine_no_db_query_url: str,\n        query_url: str,\n        use_database_callback: Callable,\n        use_engine_callback: Callable,\n        query_callback: Callable,\n        cache_enabled: bool,\n    ):\n        system_engine_call_counter = 0\n    \n        def system_engine_callback_counter(request, **kwargs):\n            nonlocal system_engine_call_counter\n            system_engine_call_counter += 1\n            return get_system_engine_callback(request, **kwargs)\n    \n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(system_engine_callback_counter, url=get_system_engine_url)\n        httpx_mock.add_callback(\n            use_database_callback,\n            url=system_engine_no_db_query_url,\n            match_content=f'USE DATABASE \"{db_name}\"'.encode(\"utf-8\"),\n        )\n    \n        httpx_mock.add_callback(\n            use_engine_callback,\n            url=system_engine_query_url,\n            match_content=f'USE ENGINE \"{engine_name}\"'.encode(\"utf-8\"),\n        )\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        for _ in range(3):\n            with connect(\n                database=db_name,\n                engine_name=engine_name,\n                auth=auth,\n                account_name=account_name,\n                api_endpoint=api_endpoint,\n                disable_cache=not cache_enabled,\n            ) as connection:\n                connection.cursor().execute(\"select*\")\n    \n        if cache_enabled:\n>           assert system_engine_call_counter == 1, \"System engine URL was not cached\"\nE           AssertionError: System engine URL was not cached\nE           assert 3 == 1\n\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/db/test_connection.py:246: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"clear_cache","time":{"start":1729998839220,"stop":1729998839220,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs","time":{"start":1729998839221,"stop":1729998839226,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"global_fake_fs::0","time":{"start":1729998839777,"stop":1729998839777,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.unit.db"},{"name":"suite","value":"test_connection"},{"name":"host","value":"fv-az732-443"},{"name":"thread","value":"2172-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.db.test_connection"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"cache_enabled","value":"True"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":74,"broken":0,"skipped":0,"passed":22,"unknown":0,"total":96},"items":[{"uid":"275067c5953a6879","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/340//#testresult/275067c5953a6879","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729998709413,"stop":1729998709836,"duration":423}},{"uid":"d878f88a5d942b48","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/336//#testresult/d878f88a5d942b48","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729912146563,"stop":1729912146976,"duration":413}},{"uid":"9a421d83565f638e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/339//#testresult/9a421d83565f638e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729912007981,"stop":1729912008404,"duration":423}},{"uid":"9b4265590b24b9fe","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/335//#testresult/9b4265590b24b9fe","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729825960903,"stop":1729825961335,"duration":432}},{"uid":"95e8f5a09a2e5833","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/338//#testresult/95e8f5a09a2e5833","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729825822549,"stop":1729825822971,"duration":422}},{"uid":"8755c29030d9cab0","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/334//#testresult/8755c29030d9cab0","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729739456736,"stop":1729739457154,"duration":418}},{"uid":"60e72ad1fce84359","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/337//#testresult/60e72ad1fce84359","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729739305959,"stop":1729739306375,"duration":416}},{"uid":"166b4046f5a0e1b4","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/333//#testresult/166b4046f5a0e1b4","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729653065153,"stop":1729653065563,"duration":410}},{"uid":"1b820979d8b6551f","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/336//#testresult/1b820979d8b6551f","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729652924170,"stop":1729652924593,"duration":423}},{"uid":"830e329b70532d7","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/332//#testresult/830e329b70532d7","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729566716138,"stop":1729566716555,"duration":417}},{"uid":"68217f7cac9b765f","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/335//#testresult/68217f7cac9b765f","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729566579826,"stop":1729566580245,"duration":419}},{"uid":"f6930315a04bd040","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/331//#testresult/f6930315a04bd040","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729480425406,"stop":1729480425806,"duration":400}},{"uid":"128585975d7a65bb","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/334//#testresult/128585975d7a65bb","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729480298005,"stop":1729480298429,"duration":424}},{"uid":"577bd0cf4d933a6e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/330//#testresult/577bd0cf4d933a6e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729394075292,"stop":1729394075720,"duration":428}},{"uid":"c23772ad6912cd08","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/333//#testresult/c23772ad6912cd08","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729393937266,"stop":1729393937684,"duration":418}},{"uid":"6fa748b55b4b919","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/329//#testresult/6fa748b55b4b919","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729307408097,"stop":1729307408510,"duration":413}},{"uid":"5cbf8fb2f94bde31","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/332//#testresult/5cbf8fb2f94bde31","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729307287065,"stop":1729307287486,"duration":421}},{"uid":"96ae5c7542b9a8fe","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/328//#testresult/96ae5c7542b9a8fe","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729221110466,"stop":1729221110887,"duration":421}},{"uid":"8489f6c90c526dbe","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/331//#testresult/8489f6c90c526dbe","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729220964118,"stop":1729220964543,"duration":425}},{"uid":"a41312ad318dafc7","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/327//#testresult/a41312ad318dafc7","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1729134660364,"stop":1729134660782,"duration":418}}]},"tags":[]},"source":"6f6b0f4e9257b5f5.json","parameterValues":["True"]}
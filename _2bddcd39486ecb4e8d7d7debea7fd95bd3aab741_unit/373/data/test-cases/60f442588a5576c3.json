{"uid":"60f442588a5576c3","name":"test_connect_caching[True]","fullName":"tests.unit.db.test_connection#test_connect_caching","historyId":"d696a77f76f4bb8d897419f7b893e9d1","time":{"start":1732850173712,"stop":1732850174154,"duration":442},"status":"failed","statusMessage":"AssertionError: System engine URL was not cached\nassert 3 == 1","statusTrace":"db_name = 'database', engine_name = 'mock_engine_name'\nauth_url = 'https://id.mock.firebolt.io/oauth/token'\napi_endpoint = 'api-dev.mock.firebolt.io'\nauth = <firebolt.client.auth.client_credentials.ClientCredentials object at 0x7f9a4a135dc0>\naccount_name = 'mock_account_name'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7f9a4a4d4ee0>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7f9a4a2c2670>\nget_system_engine_url = URL('https://api-dev.mock.firebolt.io/web/v3/account/mock_account_name/engineUrl')\nget_system_engine_callback = <function get_system_engine_callback.<locals>.inner at 0x7f9a4a2c2f70>\nsystem_engine_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact&database=database'\nsystem_engine_no_db_query_url = 'https://bravo.a.eu-west-1.aws.mock.firebolt.io/?output_format=JSON_Compact'\nquery_url = URL('https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database')\nuse_database_callback = <function use_database_callback.<locals>.inner at 0x7f9a4a39a820>\nuse_engine_callback = <function use_engine_callback.<locals>.inner at 0x7f9a4a39a160>\nquery_callback = <function query_callback.<locals>.do_query at 0x7f9a4a3be040>\ncache_enabled = True\n\n    @mark.parametrize(\"cache_enabled\", [True, False])\n    def test_connect_caching(\n        db_name: str,\n        engine_name: str,\n        auth_url: str,\n        api_endpoint: str,\n        auth: Auth,\n        account_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        get_system_engine_url: str,\n        get_system_engine_callback: Callable,\n        system_engine_query_url: str,\n        system_engine_no_db_query_url: str,\n        query_url: str,\n        use_database_callback: Callable,\n        use_engine_callback: Callable,\n        query_callback: Callable,\n        cache_enabled: bool,\n    ):\n        system_engine_call_counter = 0\n    \n        def system_engine_callback_counter(request, **kwargs):\n            nonlocal system_engine_call_counter\n            system_engine_call_counter += 1\n            return get_system_engine_callback(request, **kwargs)\n    \n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(system_engine_callback_counter, url=get_system_engine_url)\n        httpx_mock.add_callback(\n            use_database_callback,\n            url=system_engine_no_db_query_url,\n            match_content=f'USE DATABASE \"{db_name}\"'.encode(\"utf-8\"),\n        )\n    \n        httpx_mock.add_callback(\n            use_engine_callback,\n            url=system_engine_query_url,\n            match_content=f'USE ENGINE \"{engine_name}\"'.encode(\"utf-8\"),\n        )\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        for _ in range(3):\n            with connect(\n                database=db_name,\n                engine_name=engine_name,\n                auth=auth,\n                account_name=account_name,\n                api_endpoint=api_endpoint,\n                disable_cache=not cache_enabled,\n            ) as connection:\n                connection.cursor().execute(\"select*\")\n    \n        if cache_enabled:\n>           assert system_engine_call_counter == 1, \"System engine URL was not cached\"\nE           AssertionError: System engine URL was not cached\nE           assert 3 == 1\n\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/db/test_connection.py:246: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"clear_cache","time":{"start":1732850173615,"stop":1732850173615,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs","time":{"start":1732850173615,"stop":1732850173621,"duration":6},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"global_fake_fs::0","time":{"start":1732850174201,"stop":1732850174202,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.unit.db"},{"name":"suite","value":"test_connection"},{"name":"host","value":"fv-az1215-195"},{"name":"thread","value":"2104-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.db.test_connection"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"cache_enabled","value":"True"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":139,"broken":0,"skipped":0,"passed":22,"unknown":0,"total":161},"items":[{"uid":"a7a0b583a49279bf","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/369//#testresult/a7a0b583a49279bf","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732763936102,"stop":1732763936523,"duration":421}},{"uid":"a88e4e4bb832b46e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/372//#testresult/a88e4e4bb832b46e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732763794407,"stop":1732763794840,"duration":433}},{"uid":"2358af5721e1e7ec","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/368//#testresult/2358af5721e1e7ec","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732677538942,"stop":1732677539364,"duration":422}},{"uid":"bf9b670d3cf9d95e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/371//#testresult/bf9b670d3cf9d95e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732677397399,"stop":1732677397844,"duration":445}},{"uid":"ae597ae0f31ac8d","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/367//#testresult/ae597ae0f31ac8d","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732591032905,"stop":1732591033328,"duration":423}},{"uid":"7619b20a8ef9dab7","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/370//#testresult/7619b20a8ef9dab7","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732590884914,"stop":1732590885332,"duration":418}},{"uid":"3171661f5231b579","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/366//#testresult/3171661f5231b579","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732504719001,"stop":1732504719437,"duration":436}},{"uid":"3215bfeeada7699a","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/369//#testresult/3215bfeeada7699a","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732504564813,"stop":1732504565238,"duration":425}},{"uid":"2e43b0856e4b662a","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/365//#testresult/2e43b0856e4b662a","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732418364597,"stop":1732418365011,"duration":414}},{"uid":"3b3462b878ab9fa8","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/368//#testresult/3b3462b878ab9fa8","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732418212397,"stop":1732418212826,"duration":429}},{"uid":"1173361689ed7bb1","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/364//#testresult/1173361689ed7bb1","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732331645924,"stop":1732331646357,"duration":433}},{"uid":"adc5fc5d209c1e3d","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/367//#testresult/adc5fc5d209c1e3d","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732331501701,"stop":1732331502121,"duration":420}},{"uid":"655154b2bc7f2689","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/363//#testresult/655154b2bc7f2689","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732245361142,"stop":1732245361570,"duration":428}},{"uid":"8a762026b19dad48","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/366//#testresult/8a762026b19dad48","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732245234728,"stop":1732245235173,"duration":445}},{"uid":"8009022f573c5869","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/362//#testresult/8009022f573c5869","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732158917625,"stop":1732158918059,"duration":434}},{"uid":"98434d18482d4fa9","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/365//#testresult/98434d18482d4fa9","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732158768407,"stop":1732158768832,"duration":425}},{"uid":"51cd184d9e46fa86","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/361//#testresult/51cd184d9e46fa86","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732072514959,"stop":1732072515377,"duration":418}},{"uid":"b98e029118de60b8","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/364//#testresult/b98e029118de60b8","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1732072371567,"stop":1732072371982,"duration":415}},{"uid":"7cccc2030cbbba65","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/360//#testresult/7cccc2030cbbba65","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1731986149473,"stop":1731986149899,"duration":426}},{"uid":"f0b1efd8294edf1e","reportUrl":"https://firebolt-db.github.io/firebolt-python-sdk/_2bddcd39486ecb4e8d7d7debea7fd95bd3aab741_unit/363//#testresult/f0b1efd8294edf1e","status":"failed","statusDetails":"AssertionError: System engine URL was not cached\nassert 3 == 1","time":{"start":1731986016692,"stop":1731986017122,"duration":430}}]},"tags":[]},"source":"60f442588a5576c3.json","parameterValues":["True"]}
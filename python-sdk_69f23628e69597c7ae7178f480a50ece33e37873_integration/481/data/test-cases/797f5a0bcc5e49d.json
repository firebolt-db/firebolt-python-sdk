{"uid":"797f5a0bcc5e49d","name":"test_long_query[remote]","fullName":"tests.integration.dbapi.sync.V2.test_queries#test_long_query","historyId":"c66814168378ce070fb5f3d193d9255d","time":{"start":1754402498484,"stop":1754402508758,"duration":10274},"description":"AWS ALB TCP timeout set to 350; make sure we handle the keepalive correctly.","descriptionHtml":"<p>AWS ALB TCP timeout set to 350; make sure we handle the keepalive correctly.</p>\n","status":"broken","statusMessage":"httpx.HTTPStatusError: Server error '502 Bad Gateway' for url 'https://automation-firebolt.api.us-east-1.staging.firebolt.io/?database=integration_testing__1754402296837&engine=integration_testing__1754402296837&output_format=JSON_Compact'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502","statusTrace":"connection = <firebolt.db.connection.Connection object at 0x7fc9e2c20f20>\nminimal_time = <function minimal_time.<locals>.setter at 0x7fc9e3f30d30>\nlong_test_value = <function long_test_value.<locals>.long_test_value_with_default at 0x7fc9e2c29af0>\n\n    @mark.slow\n    @mark.timeout(timeout=550)\n    def test_long_query(\n        connection: Connection,\n        minimal_time: Callable[[float], None],\n        long_test_value: Callable[[int], int],\n    ) -> None:\n        \"\"\"AWS ALB TCP timeout set to 350; make sure we handle the keepalive correctly.\"\"\"\n    \n        minimal_time(350)\n    \n        with connection.cursor() as c:\n>           c.execute(\n                LONG_SELECT.format(long_value=long_test_value(LONG_SELECT_DEFAULT_V2))\n            )\n\ntests/integration/dbapi/sync/V2/test_queries.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/common/cursor/decorators.py:24: in inner\n    return func(self, *args, **kwargs)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:403: in execute\n    self._do_execute(query, params_list, skip_parsing, timeout=timeout_seconds)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:251: in _do_execute\n    self._execute_single_query(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:305: in _execute_single_query\n    self._handle_query_execution(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:334: in _handle_query_execution\n    self._raise_if_error(resp)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:122: in _raise_if_error\n    raise_error_from_response(resp)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/utils/util.py:189: in raise_error_from_response\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [502 Bad Gateway]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Server error '502 Bad Gateway' for url 'https://automation-firebolt.api.us-east-1.staging.firebolt.io/?database=integration_testing__1754402296837&engine=integration_testing__1754402296837&output_format=JSON_Compact'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502\n\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/httpx/_models.py:763: HTTPStatusError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"engine_name","time":{"start":1754402403830,"stop":1754402403831,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth","time":{"start":1754402403831,"stop":1754402404053,"duration":222},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_id","time":{"start":1754402403831,"stop":1754402403831,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"service_secret","time":{"start":1754402403831,"stop":1754402403831,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"database_name","time":{"start":1754402403831,"stop":1754402403831,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_auth","time":{"start":1754402404053,"stop":1754402404053,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1754402404053,"stop":1754402404053,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"account_name","time":{"start":1754402404053,"stop":1754402404053,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"core_url","time":{"start":1754402404054,"stop":1754402404054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connection","time":{"start":1754402497392,"stop":1754402498483,"duration":1091},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"minimal_time","time":{"start":1754402498483,"stop":1754402498483,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"long_test_value","time":{"start":1754402498483,"stop":1754402498483,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"AWS ALB TCP timeout set to 350; make sure we handle the keepalive correctly.","status":"broken","statusMessage":"httpx.HTTPStatusError: Server error '502 Bad Gateway' for url 'https://automation-firebolt.api.us-east-1.staging.firebolt.io/?database=integration_testing__1754402296837&engine=integration_testing__1754402296837&output_format=JSON_Compact'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502","statusTrace":"connection = <firebolt.db.connection.Connection object at 0x7fc9e2c20f20>\nminimal_time = <function minimal_time.<locals>.setter at 0x7fc9e3f30d30>\nlong_test_value = <function long_test_value.<locals>.long_test_value_with_default at 0x7fc9e2c29af0>\n\n    @mark.slow\n    @mark.timeout(timeout=550)\n    def test_long_query(\n        connection: Connection,\n        minimal_time: Callable[[float], None],\n        long_test_value: Callable[[int], int],\n    ) -> None:\n        \"\"\"AWS ALB TCP timeout set to 350; make sure we handle the keepalive correctly.\"\"\"\n    \n        minimal_time(350)\n    \n        with connection.cursor() as c:\n>           c.execute(\n                LONG_SELECT.format(long_value=long_test_value(LONG_SELECT_DEFAULT_V2))\n            )\n\ntests/integration/dbapi/sync/V2/test_queries.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/common/cursor/decorators.py:24: in inner\n    return func(self, *args, **kwargs)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:403: in execute\n    self._do_execute(query, params_list, skip_parsing, timeout=timeout_seconds)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:251: in _do_execute\n    self._execute_single_query(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:305: in _execute_single_query\n    self._handle_query_execution(\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:334: in _handle_query_execution\n    self._raise_if_error(resp)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/db/cursor.py:122: in _raise_if_error\n    raise_error_from_response(resp)\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/firebolt/utils/util.py:189: in raise_error_from_response\n    resp.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [502 Bad Gateway]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Server error '502 Bad Gateway' for url 'https://automation-firebolt.api.us-east-1.staging.firebolt.io/?database=integration_testing__1754402296837&engine=integration_testing__1754402296837&output_format=JSON_Compact'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502\n\n/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/httpx/_models.py:763: HTTPStatusError","steps":[],"attachments":[{"uid":"16d536ac028d6745","name":"log","source":"16d536ac028d6745.txt","type":"text/plain","size":135}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"minimal_time::0","time":{"start":1754402509097,"stop":1754402509097,"duration":0},"status":"failed","statusMessage":"AssertionError: Test took 10.613661766052246 seconds, less than 350 seconds\nassert (1754402509.09694 - 1754402498.4832783) >= 350\n","statusTrace":"  File \"/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/allure_commons/_allure.py\", line 231, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/opt/hostedtoolcache/Python/3.9.23/x64/lib/python3.9/site-packages/_pytest/fixtures.py\", line 916, in _teardown_yield_fixture\n    next(it)\n  File \"/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/integration/conftest.py\", line 172, in minimal_time\n    assert (\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"connection::0","time":{"start":1754402509098,"stop":1754402509098,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"slow"},{"name":"parentSuite","value":"tests.integration.dbapi.sync.V2"},{"name":"suite","value":"test_queries"},{"name":"host","value":"pkrvmjbmru5nbw0"},{"name":"thread","value":"2457-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.dbapi.sync.V2.test_queries"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"connection","value":"'remote'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["slow"]},"source":"797f5a0bcc5e49d.json","parameterValues":["'remote'"]}
{"uid":"9e306dfda87d511b","name":"test_from_asyncio","fullName":"tests.unit.V1.async_db.test_connection#test_from_asyncio","historyId":"523c226d691b6dc91879d58365e2c072","time":{"start":1720198833589,"stop":1720198833780,"duration":191},"status":"broken","statusMessage":"httpx.TimeoutException: No response can be found for POST request on /?database=database&output_format=JSON_Compact amongst:\nMatch all requests on https://api-dev.mock.firebolt.io/auth/v1/login\nMatch all requests on https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database","statusTrace":"httpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7fee1bb85ac0>\nauth_callback = <function auth_callback.<locals>.do_mock at 0x7fee1bc28c10>\nauth_url = 'https://api-dev.mock.firebolt.io/auth/v1/login'\nquery_callback = <function query_callback.<locals>.do_query at 0x7fee1be09ca0>\nquery_url = URL('https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database')\nengine_url = 'mock_engine_name.mock.firebolt.io'\napi_endpoint = 'api-dev.mock.firebolt.io', db_name = 'database'\n\n    def test_from_asyncio(\n        httpx_mock: HTTPXMock,\n        auth_callback: Callable,\n        auth_url: str,\n        query_callback: Callable,\n        query_url: str,\n        engine_url: str,\n        api_endpoint: str,\n        db_name: str,\n    ):\n        async def async_flow() -> None:\n            async with (\n                await connect(\n                    engine_url=engine_url,\n                    database=db_name,\n                    auth=UsernamePassword(\n                        \"u\",\n                        \"p\",\n                    ),\n                    api_endpoint=api_endpoint,\n                )\n            ) as connection:\n                cursor = connection.cursor()\n                await cursor.execute(\"SELECT 1\")\n                await cursor.fetchone()\n                await cursor.fetchmany(1)\n                await cursor.fetchall()\n    \n        httpx_mock.add_callback(auth_callback, url=auth_url)\n        httpx_mock.add_callback(query_callback, url=query_url)\n>       run(async_flow())\n\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/V1/async_db/test_connection.py:481: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/runners.py:44: in run\n    return loop.run_until_complete(main)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/base_events.py:616: in run_until_complete\n    return future.result()\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/tests/unit/V1/async_db/test_connection.py:474: in async_flow\n    await cursor.execute(\"SELECT 1\")\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/src/firebolt/async_db/cursor.py:237: in execute\n    await self._do_execute(query, params_list, skip_parsing)\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/src/firebolt/async_db/cursor.py:183: in _do_execute\n    resp = await self._api_request(\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/src/firebolt/async_db/cursor.py:453: in _api_request\n    return await self._client.request(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/httpx/_client.py:1530: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/httpx/_client.py:1617: in send\n    response = await self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/httpx/_client.py:1645: in _send_handling_auth\n    response = await self._send_handling_redirects(\n/home/runner/work/firebolt-python-sdk/firebolt-python-sdk/src/firebolt/client/client.py:344: in _send_handling_redirects\n    return await super()._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/httpx/_client.py:1682: in _send_handling_redirects\n    response = await self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/httpx/_client.py:1719: in _send_single_request\n    response = await transport.handle_async_request(request)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pytest_httpx/_httpx_mock.py:334: in handle_async_request\n    return await self.mock._handle_async_request(*args, **kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7fee1bb85ac0>\nrequest = <Request('POST', '/?database=database&output_format=JSON_Compact')>\n\n    async def _handle_async_request(\n        self,\n        request: httpx.Request,\n    ) -> httpx.Response:\n        self._requests.append(request)\n    \n        callback = self._get_callback(request)\n        if callback:\n            response = callback(request)\n    \n            if response:\n                if inspect.isawaitable(response):\n                    response = await response\n                return _unread(response)\n    \n>       raise httpx.TimeoutException(\n            self._explain_that_no_response_was_found(request), request=request\n        )\nE       httpx.TimeoutException: No response can be found for POST request on /?database=database&output_format=JSON_Compact amongst:\nE       Match all requests on https://api-dev.mock.firebolt.io/auth/v1/login\nE       Match all requests on https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database\n\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pytest_httpx/_httpx_mock.py:211: TimeoutException","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"global_fake_fs","time":{"start":1720198833583,"stop":1720198833585,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clear_cache","time":{"start":1720198833583,"stop":1720198833583,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1720198833585,"stop":1720198833585,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"assert_all_responses_were_requested","time":{"start":1720198833585,"stop":1720198833585,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_callback","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"non_mocked_hosts","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_endpoint","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_description","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_url","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"httpx_mock","time":{"start":1720198833586,"stop":1720198833586,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_callback","time":{"start":1720198833587,"stop":1720198833587,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_statistics","time":{"start":1720198833587,"stop":1720198833587,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_data","time":{"start":1720198833587,"stop":1720198833587,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_name","time":{"start":1720198833587,"stop":1720198833588,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"query_url","time":{"start":1720198833588,"stop":1720198833588,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"engine_url","time":{"start":1720198833588,"stop":1720198833588,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_name","time":{"start":1720198833588,"stop":1720198833588,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"auth_url","time":{"start":1720198847257,"stop":1720198847257,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"httpx_mock::0","time":{"start":1720198834001,"stop":1720198834001,"duration":0},"status":"failed","statusMessage":"AssertionError: The following responses are mocked but not requested:\n  Match all requests on https://mock_engine_name.mock.firebolt.io/?output_format=JSON_Compact&database=database\nassert not [<pytest_httpx._httpx_mock._RequestMatcher object at 0x7fee1bc25970>]\n","statusTrace":"  File \"/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/_pytest/fixtures.py\", line 916, in _teardown_yield_fixture\n    next(it)\n  File \"/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pytest_httpx/__init__.py\", line 65, in httpx_mock\n    mock.reset(assert_all_responses_were_requested)\n  File \"/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pytest_httpx/_httpx_mock.py\", line 309, in reset\n    assert (\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1720198834003,"stop":1720198834003,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_fake_fs::0","time":{"start":1720198834003,"stop":1720198834004,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.unit.V1.async_db"},{"name":"suite","value":"test_connection"},{"name":"host","value":"fv-az654-356"},{"name":"thread","value":"2136-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.V1.async_db.test_connection"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"9e306dfda87d511b.json","parameterValues":[]}